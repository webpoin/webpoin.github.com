/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/goods/init",["./classify","$","dist/application/app","./category","./template/category.html","./goods","chosen","./goods_fun"],function(a){"use strict";a("./classify"),a("./category"),a("./goods"),a("./goods_fun")}),define("dist/goods/classify",["$","dist/application/app"],function(a){"use strict";var b=a("$"),c=a("dist/application/app"),e=c.config,f=b("#dragClassify"),g=(b("#noClassify"),b("#save_class")),h=b("#nestableMenu");f.length>0&&a.async("nestable",function(){f.nestable({maxDepth:2}),b(".dd-handle a").on("mousedown",function(a){a.stopPropagation()})}),g.on("click",function(){var a=b(this),c=a.data("remote")||a.attr("href");a.button("loading");var g=window.JSON.stringify(f.nestable("serialize"));b.post(c,{data:g}).done(function(b){a.button("reset"),e.issucceed(b)?e.msg.suc(b.message||e.lang.saveSuccess,b.url):e.msg.error(b.message||e.lang.saveError,b.url)}).fail(function(){a.button("reset"),e.msg.info(e.lang.exception,d.url)})}),h.on("click",function(){var a=b(this).hasClass("active");f.nestable(a?"expandAll":"collapseAll")})}),define("dist/goods/category",["$","dist/application/app"],function(a){"use strict";var b=a("$"),c=a("dist/application/app"),d=c.config,e=c.method,f=b("div.category_item_wrp");if(window.category&&(window.category.automatic=!0),f.length>0){var g=b('button[type="submit"]'),h=b('[data-toggle="category"]'),i=a("dist/goods/template/category.html"),j=d.empty,k=function(a){this.element=a,this.category_items=this.element.find("ul.category_items"),this.data=null;var c=this;b(".input_search",this.element).on("keyup propertychange",function(){c.search(b(this).val().trim())})};k.prototype.init=function(a,c){if(this.data=a,this.childs(a,this),c(),window.category.selected){var d=b('li[wid="{0}"] a'.format(window.category.selected[0]),this.element);if(d.length>0)return d.trigger("click",this),d.closest("ul").scrollTop(d.position().top-100),!0}},k.prototype.search=function(a){this.category_items.find("li").each(function(){var c=b(this);c.text().indexOf(a)>-1?c.show():c.hide()})},k.prototype.childs=function(a,c){if(a&&a.length>0){var d=new StringBuilder;if(b.each(a,function(a,b){d.Append(i.format(b.key,b.val))}),this.category_items.html(d.toString()),c.show(),window.category.selected&&window.category.automatic)for(var e=1;e<window.category.selected.length;e++){var f=b('li[wid="{0}"] a'.format(window.category.selected[e]),this.element);if(f.length>0)return f.trigger("click"),f.closest("ul").scrollTop(f.position().top-100),!0}}else g.removeAttr("disabled"),j=g.data("remote").format(b(".category_item_wrp:visible .selected").last().find("a").data("id"))},k.prototype.hide=function(){this.element.hide()},k.prototype.show=function(){this.element.show()},k.prototype.text=function(){return b(".selected",this.category_items).text()};var l=function(){var a=[],c=b(".category_item_wrp:visible .selected");b.each(c,function(){a.push(b(this).text())}),b(".js_selected_text").html(a.join(">"))},m=new Array;b.each(h,function(a,c){m.push(new k(b(c)))});var n=m.slice(1);m[0].init(window.category.data,function(){b("li a",m[0].category_items).on("click",function(a,c){var d=b(this),f=d.data("id");d.parent().addClass("selected").siblings().removeClass("selected");for(var h=n.length-1;h>=0;h--)n[h].hide();l(),g.attr("disabled","disabled"),e.get(window.category.url.format(f),function(a){m[1].childs(a,m[1])}),c||(window.category.automatic=!1)})});for(var o=1;o<m.length;o++)m[o].element.attr("index",o),b(m[o].category_items).on("click","li a",function(){var a=b(this),c=a.data("id"),d=a.parents("div.category_item_wrp"),f=d.next(),h=f.attr("index");a.parent().addClass("selected").siblings().removeClass("selected"),d.nextAll().hide(),l(),g.attr("disabled","disabled"),m[h]?e.get(window.category.url.format(c),function(a){m[h].childs(a,f)}):(g.removeAttr("disabled"),j=g.data("remote").format(b(".category_item_wrp:visible .selected").last().find("a").data("id")))});g.on("click",function(){j.length>0&&d.msg.redirect(j)})}}),define("dist/goods/template/category.html",[],'<li wid="{0}"><a href="javascript:;" data-id="{0}" title="{1}">{1}</a>\n</li>\n'),define("dist/goods/goods",["$","dist/application/app","chosen"],function(a){"use strict";var b=a("$"),c=a("dist/application/app"),d=c.config,e=c.method;a("chosen");var f=b('[data-toggle="attribute"]');window.goods_data?(template.helper("attribute_selected",function(a,b){return window.goods_data.attributes[a]==b?'checked="checked"':d.empty}),template.helper("attribute_checked",function(a,b){return window.goods_data.attributes[a]==b?'class="active"':d.empty}),template.helper("attribute_disabled",function(){return window.goods_data.shelves?'disabled="disabled"':d.empty}),template.helper("specifications_checked",function(a,c){return b.inArray(c,window.goods_data.specifications[a])>-1?'checked="checked"':d.empty})):(template.helper("attribute_selected",function(){return d.empty}),template.helper("specifications_checked",function(){return d.empty}),template.helper("attribute_disabled",function(){return d.empty}));var g=function(a){e.get(window.goods_setting.attribute_path,function(a){a.shelves=window.goods_data.shelves,f.html(template("attribute_template",a)),b(".js_custom_list_contair dl").each(function(){var a=b(this),c=a.find("ul:first"),d=c.attr("id"),e=c.find("li.active input[type='radio']:checked").data("title");b("#label_"+d).html(e)})},d.lang.attributeError),a.customInput(),b(document).on("click",".js_custom_list_save",function(){var c=b(this).parents(".js_custom_list").find(".js_custom_input"),e=b(this).data("name"),f=a.customdata(c);a.customAttrValvali(c)&&c.val()&&(a.getAttrValExist(c.val(),f.attrid)?d.msg.info("已经存在的属性值"):a.addAttrVal(f,e,c,!1,b(this))),c.val()||d.msg.error("属性值为空！")}),b(document).on("click",".js_custom_list_cancel",function(){b(this).parents(".js_custom_list").next(".js_custom_list").removeClass("hide"),b(this).parents(".js_custom_list").addClass("hide")}),b(document).on("click",".js_custom_btn",function(){b(this).parents(".js_custom_list").prev(".js_custom_list").removeClass("hide"),b(this).parents(".js_custom_list").addClass("hide");var a=b(this).parents(".custom-select");a.scrollTop(a.get(0).scrollHeight-0+60)}),b(document).on("click",".js_custom_del",function(){var c=b(this).prev("a").find("input[type='radio']"),f=c.val();e.post(window.goods_setting.custom_attrvalue_del_path,function(e){d.issucceed(e)?(c.prop("checked")?b("#label_"+e.data.attrid).html("选择"):a.getAttrValExist(b("#label_"+e.data.attrid).text(),e.data.attrid)||b("#label_"+e.data.attrid).html("选择"),c.parents("li").remove(),d.msg.info(e.message||d.lang.removeSuccess)):d.msg.error(e.message)},d.lang.attributeError,!1,{attrid:c.data("id"),attrvalid:f})}),b(document).on("click",".js_add_attr_save",function(){var c=b(this),e=b(this).parents(".js_add_attr_form"),f=e.find(".js_add_attr_input"),g=e.find(".js_add_attrv_input"),h=a.customAttrValvali(f),i=a.customAttrValvali(g);if(h&&i&&f.val()&&g.val()){var j=a.getAttrExist(f.val(),"custom-attr-dl-horizontal");if(j.flag)if(a.getAttrValExist(g.val(),j.id))d.msg.info("已经存在的属性和属性值");else{var k=b("#"+j.id).find("input[type='radio']").attr("name");a.addAttrVal({attrid:j.id,attrval:g.val()},k,g,!0,b(this))}else c.data("loadingText",'<i class="fa fa-spinner fa-spin"></i>提交中'),c.button("loading"),b.ajax(window.goods_setting.custom_attr_path,{type:"post",data:{attrname:f.val(),attrvalname:g.val()},dataType:"json"}).done(function(e){c.button("reset"),d.issucceed(e)?(e.data.index=b(".js_custom_list_contair dl").length,a.attrresult(e.data,g,"js_custom_list_contair"),d.msg.info(e.message)):d.msg.error(e.message)}).fail(function(){c.button("reset"),d.msg.info(d.lang.attributeError)})}else d.msg.error("请修改属性或属性值不正确的填写！");f.val()||g.val()?f.val()?g.val()||d.msg.error("属性值为空！"):d.msg.error("属性为空！"):d.msg.error("属性和属性值为空！")}),b(document).on("click",".js_custom_attr_del",function(){var a=b(this);d.msg.msgbox.confirm("确定删除整个分组吗？",function(c){c&&e.post(window.goods_setting.custom_attr_del_path,function(a){if(d.issucceed(a)){var c=b("#"+a.data.attrid).parents("dl"),e=c.index(),f=c.nextAll("dl");c.remove(),f.each(function(a){b(this).find("input[type='hidden']").attr("name","attribute["+(e+a)+"].id"),b(this).find("input[type='radio']").attr("name","attribute["+(e+a)+"].selected"),b(this).find(".js_custom_list_save").attr("data-name","attribute["+(e+a)+"].selected")}),d.msg.info(a.message||d.lang.removeSuccess)}else d.msg.error(a.message)},d.lang.attributeError,!1,{attrid:a.data("id")})})}),b(document).on("click",".js_add_attr_btn",function(){b(".js_add_attr").addClass("hide"),b(".js_add_attr_form").removeClass("hide")}),b(document).on("click",".js_add_attr_cancel",function(){a.closeAttrForm()}),b(document).on("click","dd li",function(){b(this).find("input[type='radio']").length>0&&(b(this).closest("li").show(),b(this).closest("dd").find(".js_custom_dropdown_label").removeClass("error"))}),b(document).on("click",".js_custom_dropdown_label",function(){var a=b(this).data("id"),c=b(this).html();if("选择"==c)b(this).html(""),b("#"+a).find("li").show();else{var d=0;b("#"+a).find("input[type='radio']").each(function(){b(this).prop("checked")&&(d=1)}),d&&b("#"+a).find("li").show()}return"block"==b("#"+a).css("display")?!1:void 0}),b(document).on("click",".dropdown-toggle",function(){b(this).find(".js_custom_dropdown_label").trigger("click")}),b("body").on("blur",".js_custom_dropdown_label",function(){var a=b(this).data("id"),c=b(this).html();if(c){if("选择"!=c){var d=0;b("#"+a).find("input[type='radio']").each(function(){b(this).prop("checked")&&(b(this).data("title")==c?d=1:(b(this).removeAttr("checked"),b(this).parent().parent().removeClass("active")))}),d?b(this).removeClass("error"):b(this).addClass("error")}}else b(this).html("选择"),b("#"+a).find("input[type='radio']").each(function(){b(this).removeAttr("checked"),b(this).parent().parent().show(),b(this).parent().parent().removeClass("active")}),b(this).removeClass("error")}),b(document).on("keyup",".js_custom_dropdown_label",function(){var c=b(this).data("id"),d=b(this).text(),e=b("#"+c).find(".js_search_result"),f=a.attrValSearch(d,c);f?e.addClass("hide"):(e.find("a").html("未找到"+d),e.removeClass("hide"))})},h=b('[data-toggle="specifications"]'),i=b("div.specificationstable"),j=b("div.nospecifications"),k=function(){this.specVals=null,this.SpecificationsList=null,this.TableData={ths:[]},this.specificationstable=b('[data-toggle="specificationstable"]');{var a=this;b('[data-toggle="specvals"]')}b('[data-toggle="specification-enable"]').on("click",function(){var a=b(this).data("enable");h.toggle(a),a?(i.show(),j.hide()):(i.hide(),j.show())});var c=b('[data-toggle="specification-enable"]:checked').data("enable");c?(h.show(),i.show(),j.hide()):j.show(),e.get(window.goods_setting.specifications_path,function(d){a.SpecificationsList=d.data,b.each(d.data,function(b,c){a.TableData.ths.push(c)}),h.html(template("specifications_template",d)),a.init(),c&&a.acquire()},d.lang.specificationsError)},l=function(){};l.prototype.getAttrExist=function(a,c){var d,e,f=[],g="";return b("."+c).find("dt").each(function(){b(this).data("title")&&f.push(b(this).data("title"))}),e=b.inArray(a,f),d=0>e?!1:!0,g=b("."+c).find("dt").eq(e).data("id"),{flag:d,id:g}},l.prototype.getAttrValExist=function(a,c){var d,e,f=[];return b("#"+c).find("input[type='radio']").each(function(){b(this).val()&&f.push(b(this).data("title"))}),e=b.inArray(a,f),d=0>e?!1:!0},l.prototype.attrValSearch=function(a,c){var d=0;return b("#"+c).find("input[type='radio']").each(function(){var c=b(this).data("title")||"选择",e=b(this).parent().parent();c&&(c+="",c.indexOf(a)>-1?(d++,e.show()):e.hide())}),d},l.prototype.getSpevalExist=function(a,c){var d,e,f=[];return b("#specvals_show_"+c).find(".js_specvals_show").each(function(){f.push(b(this).data("name"))}),e=b.inArray(a,f),d=0>e?!1:!0},l.prototype.spevalExist=function(a,c){var d,e=[],f=this.getSpelist(a).arrval,g="";return b("#specvals_show_"+c).find(".js_specvals_show").each(function(){e.push(b(this).data("name"))}),b(f).each(function(a,c){d=b.inArray(c,e),d>-1&&(g+=c+",")}),g},l.prototype.getnSpevalExist=function(a){var c,d,e=[];return b(".js_spe_spev_show").find(".js_specvals_show").each(function(){e.push(b(this).data("name"))}),d=b.inArray(a,e),c=0>d?!1:!0},l.prototype.addAttrVal=function(a,c,e,f,g){var h=this;g.data("loadingText",'<i class="fa fa-spinner fa-spin"></i>提交中'),g.button("loading"),b.ajax(window.goods_setting.custom_attrvalue_path,{type:"post",data:a,dataType:"json"}).done(function(a){g.button("reset"),d.issucceed(a)?(a.data.checked=!0,a.data.name=c,h.result(a.data,e,f)):d.msg.error(a.message)}).fail(function(){g.button("reset"),d.msg.info(d.lang.attributeError)})},l.prototype.closeAttrForm=function(){b(".js_add_attr").removeClass("hide"),b(".js_add_attr_form").addClass("hide")},l.prototype.attrresult=function(a,c,e){var f=b("."+e).find("dl:last");f.length?b(template("customattr_tem",a)).insertAfter(f):b(template("customattr_tem",a)).insertBefore(b("."+e).find(".line-dashed:first")),c.val(""),c.next(".js_limit").find("em").html(0),b(".js_add_attr_input").val(""),b(".js_add_attr_input").next(".js_limit").find("em").html(0),this.closeAttrForm(),d.msg.info(d.lang.saveSuccess)},l.prototype.result=function(a,c,e){var f=b("#"+a.attrid).find(".js_custom_list:first");b("#"+a.attrid).find("li").removeClass("active"),b("#"+a.attrid).find("li input[type='radio']").removeAttr("checked"),b(template("customattrval_tem",a)).insertBefore(f),b("#label_"+a.attrid).html(a.title),b("#label_"+a.attrid).removeClass("error"),b(document).trigger("click"),c.val(""),c.next(".js_limit").find("em").html(0),e?(b(".js_add_attr_input").val(""),b(".js_add_attr_input").next(".js_limit").find("em").html(0),this.closeAttrForm()):(f.addClass("hide"),f.next(".js_custom_list").removeClass("hide")),b("#"+a.attrid).find(".js_search_result").addClass("hide"),d.msg.info(d.lang.saveSuccess)},l.prototype.customAttrValvali=function(a){var b=!0,c=a.data("limit")-0,d=this.getInputLen(a);return b=d>2*c?!1:!0},l.prototype.customInput=function(){var a=this;b(document).on("keyup",".js_custom_input",function(){var c=a.getInputLen(b(this)),d=b(this).data("limit")-0,e=b(this).next(".js_limit");e.find("em").html(Math.ceil(c/2)),c>2*d?e.addClass("error"):e.removeClass("error")})},l.prototype.getInputLen=function(a){return a.val().replace(/[^\x00-\xff]/g,"xx").length},l.prototype.customdata=function(a){return{attrid:a.data("id"),attrval:a.val()}},l.prototype.getSpelist=function(a){var c=[],d=[];return a.find(".js_specvals_temp").each(function(){c.push(b(this).data("name"))}),a.find(".js_specvals_del .js_del_specvals_val_list").each(function(){d.push(b(this).data("id"))}),{arrval:c,idarr:d}},l.prototype.saveSpeval=function(a,c){var e=this;c.data("loadingText",'<i class="fa fa-spinner fa-spin"></i>提交中'),c.button("loading"),b.ajax(window.goods_setting.custom_spevalue_path,{type:"post",data:a,dataType:"json"}).done(function(a){c.button("reset"),d.issucceed(a)?(e.resultSpeval(a.data),d.msg.info(a.message||d.lang.removeSuccess)):d.msg.error(a.message)}).fail(function(){c.button("reset"),d.msg.info(d.lang.attributeError)})},l.prototype.saveSpe=function(a,c){var e=this;c.data("loadingText",'<i class="fa fa-spinner fa-spin"></i>提交中'),c.button("loading"),b.ajax(window.goods_setting.custom_spe_path,{type:"post",data:a,dataType:"json"}).done(function(a){c.button("reset"),d.issucceed(a)?(e.resultSpe(a.data),b(".js_nospe_tips").addClass("hide"),d.msg.info(a.message||d.lang.removeSuccess)):d.msg.error(a.message)}).fail(function(){c.button("reset"),d.msg.info(d.lang.attributeError)})},l.prototype.delSpeval=function(a){var c=this;b.ajax(window.goods_setting.custom_delspevalue_path,{type:"post",data:a,dataType:"json"}).done(function(a){d.issucceed(a)?(c.resultdelSpeval(a.data),m.SpecificationsListskey().delspvals(a.data.speid,a.data.spevalidList),d.msg.info(a.message||d.lang.removeSuccess)):d.msg.error(a.message)}).fail(function(){d.msg.info(d.lang.attributeError)})},l.prototype.resultSpeval=function(a){var c=a.speid,d=b("#specvals_"+c),e=b("#specvals_show_"+c).find("div");d.append(template("specv_tem",a)),this.closeopen(c,!0),e.find(".js_specvals_temp").remove(),e.append(template("specv_result_tem",a))},l.prototype.resultSpe=function(a){b(template("spe_result_tem",a)).insertBefore(b(".js_add_spe_div"));var c={id:a.id,name:a.name,all_val:a.spevalList};m.SpecificationsList.push(c),m.TableData.ths.push(c),m.acquire(),b(".js_add_spe_input").val(""),b(".js_add_spe_input").next(".js_limit").find("em").html(0),b(".js_spe_spev_show").find(".js_specvals_temp").remove(),this.specloseopen(!0)},l.prototype.resultdelSpeval=function(a){var c=a.speid,d=b("#specvals_"+c),e=b("#specvals_show_"+c).find("div");this.closeopen(c,!0),b(a.spevalidList).each(function(a,b){d.find("#spe_"+b).remove()}),e.find(".js_specvals_del").remove()},l.prototype.closeopen=function(a,c){b("#specvals_ed_"+a).toggleClass("hide",c),b("#js_specifications_"+a).toggleClass("hide",!c),b(".js_add_spe_div,.js_specifica_edit,.js_specifica_del").toggleClass("hide",!c)},l.prototype.specloseopen=function(a){b(".js_add_spe_form").toggleClass("hide",a),b(".js_add_spe_div,.js_specifica_edit,.js_specifica_del").toggleClass("hide",!a)},l.prototype.getSpeExist=function(a){var c,d,e=[],f="";return b("[data-toggle='specifications']").find(".js_specifica").each(function(){b(this).data("name")&&e.push(b(this).data("name"))}),d=b.inArray(a,e),c=0>d?!1:!0,f=b("[data-toggle='specifications']").find(".js_specifica").eq(d).data("id"),{flag:c,id:f}},k.prototype.acquire=function(){this.selectSpecifications_vals=new Array;var a=this;a.TableData.ths=[],b.each(this.SpecificationsList,function(c,d){var e=d.id,f=b("#specvals_"+e).find('[type="checkbox"]:checked'),g=new Array;b.each(f,function(a,b){g.push({val:b.title,key:b.value})});var h=g.length>0;h&&a.TableData.ths.push(d),h&&a.selectSpecifications_vals.push(g)}),this.showtable=this.selectSpecifications_vals.length,this.showtable&&this.generate(),this.showtable||this.specificationstable.html('<span class="help-block">请选择规格</span>')},k.prototype.generate=function(){this.res=this.combine(this.selectSpecifications_vals.reverse()),this.rowspan(),this.TableData.trs=[];var a=this;b.each(this.res,function(c,d){var e=[],f=[];b.each(d,function(b,d){var g=[];g.rowspan=a.row[b],g.key=d.key,g.val=d.val,g.index=c,e.push(g),f.push(d.key)});var g=f.join(":"),h={tds:e,index:c,key:g};if(a.changeval(g),window.goods_data||(window.goods_data={products:{}}),window.goods_data&&window.goods_data.products){var i=window.goods_data.products[g];i&&(h=b.extend({},h,i))}a.TableData.trs.push(h)}),this.specificationstable.html(template("specifications_table_template",this.TableData)),i.show()},k.prototype.changeval=function(a){!window.goods_data.products[a]&&(window.goods_data.products[a]={}),b(document).on("change",'[data-id="'+a+'"]',function(){var a=b(this),c=a.data("id"),d=a.data("name"),e=b('[data-id="'+c+'"]'),f={};b.each(e,function(){var c={},e=a.val();c[d]=e,f=b.extend({},f,c)});var g=a.closest("tr").siblings().find('[data-name="'+d+'"]');a.valid()&&b.each(g,function(){var c=b(this);c.val().length<1&&(c.val(a.val()),c.valid())}),window.goods_data.products[c]=f})},k.prototype.rowspan=function(){for(var a=[],b=this.res.length,c=this.selectSpecifications_vals.length-1;c>-1;c--)a[c]=parseInt(b/this.selectSpecifications_vals[c].length),b=a[c];this.row=a.reverse()},k.prototype.refresh=function(){var a=this;a.TableData.ths=[],b.each(a.SpecificationsList,function(b,c){a.TableData.ths.push(c)}),this.acquire()},k.prototype.SpecificationsListskey=function(){var a=this;return{delsp:function(b){for(var c=[],d=0,e=a.SpecificationsList.length;e>d;d++)a.SpecificationsList[d].id!=b&&c.push(a.SpecificationsList[d]);a.SpecificationsList=c,a.refresh()},delspvals:function(b,c){for(var d=0,e=a.SpecificationsList.length;e>d;d++)if(a.SpecificationsList[d].id==b){for(var f=[],g=0,h=a.SpecificationsList[d].all_val.length;h>g;g++)for(var i=0,j=c.length;j>i;i++)a.SpecificationsList[d].all_val[g].key!=c[i]&&f.push(a.SpecificationsList[d].all_val[g]);a.SpecificationsList[d].all_val=f}a.refresh()}}},k.prototype.combine=function(a){var b=[];return function c(a,d,e){if(0==e)return b.push(a);for(var f=0;f<d[e-1].length;f++)c(a.concat(d[e-1][f]),d,e-1)}([],a,a.length),b},k.prototype.init=function(){var a=this;b(document).on("click",'[data-toggle="specvals"] input[type="checkbox"]',function(){a.acquire()});var c=new l;b(document).on("click",".js_add_speval",function(){var a=b(this).closest(".form-group").find("input"),d=b(this).data("id"),e=a.val();c.customAttrValvali(a)&&e?c.getSpevalExist(e,d)?b("#specvals_error_"+d).html("输入的规格值已存在"):(b("#specvals_error_"+d).html(""),b("#specvals_show_"+d).find("div").append(template("specv_show_tem",{val:e,speid:d})),a.val(""),a.next(".js_limit").find("em").html(0)):b("#specvals_error_"+d).html("请输入规格值，长度不要超过15个字")}),b(document).on("click",".js_spe_speval",function(){var a=b(".js_add_spev_input"),d=a.val();c.customAttrValvali(a)&&d?c.getnSpevalExist(d)?b(".js_js_spe_spev_error").html("输入的规格值已存在"):(b(".js_js_spe_spev_error").html(""),b(".js_spe_spev_show").append(template("specv_show_tem",{val:d,speid:""})),a.val(""),a.next(".js_limit").find("em").html(0)):b(".js_js_spe_spev_error").html("请输入规格值，长度不要超过15个字")}),b(document).on("click",".js_specifica_edit",function(){var a=b(this).data("id");c.closeopen(a,!1),b(".js_add_spe_div,.js_specifica_edit,.js_specifica_del").addClass("hide")}),b(document).on("click",".js_specvals_val_save",function(){var a=b(this).data("id"),e=b(this).closest(".form-group").prev(".form-group"),f=c.getSpelist(e),g=f.arrval,h=f.idarr,i={speid:a,speval:g};g.length>0&&c.saveSpeval(i,b(this)),h.length>0&&c.delSpeval({speid:a,idarr:h},b(this)),g.length<1&&h.length<1&&d.msg.error("请添加规格值或者删除规格值")}),b(document).on("click",".js_specvals_val_cancel",function(){var a=b(this).data("id");c.closeopen(a,!0)}),b(document).on("click",".js_del_specvals_val_list",function(){var a=b(this).data("id");a?b(this).parent().removeClass("js_specvals_result").addClass("hide js_specvals_del"):b(this).parent().remove()}),b(document).on("click",".js_add_spe_btn",function(){c.specloseopen(!1)}),b(document).on("click",".js_add_spe_save",function(){var a=b(".js_add_spe_input").val(),e=(b(".js_add_spev_input").val(),b(".js_spe_spev_show").find(".js_specvals_temp").length),f=c.getSpeExist(a);if(b(".js_js_spe_spev_error").html(""),a)if(c.customAttrValvali(b(".js_add_spe_input")))if(f.flag)if(e>0){var g=c.spevalExist(b(".js_spe_spev_show"),f.id);if(g.length>0)b(".js_js_spe_spev_error").html("输入的规格值："+g+"已存在");else{var h=f.id,i=b(this).closest(".form-group").prev(".form-group"),j=c.getSpelist(i),k=j.arrval,l=(j.idarr,{speid:h,speval:k});k.length>0&&(c.saveSpeval(l,b(this)),b(".js_add_spe_input").val(""),b(".js_add_spe_input").next(".js_limit").find("em").html(0),b(".js_spe_spev_show").find(".js_specvals_temp").remove(),c.specloseopen(!0))}}else d.msg.error("请添加规格值");else{var m=c.getSpelist(b(".js_spe_spev_show")).arrval,l={spe:a,speval:m};m.length>0?c.saveSpe(l,b(this)):d.msg.error("请添加规格值")}else d.msg.error("规格只能输入5个字请修改规则");else d.msg.error("请添加规格")}),b(document).on("click",".js_add_spe_cancel",function(){c.specloseopen(!0)}),b(document).on("click",".js_specifica_del",function(){var c=b(this).data("id"),f=b(this).data("name");d.msg.msgbox.confirm("确定删除规格："+f+"，及其所属的规格吗？",function(f){f&&e.post(window.goods_setting.custom_spe_del_path,function(c){d.issucceed(c)?(d.msg.info(c.message||d.lang.removeSuccess),b("#js_specifications_"+c.data.speid).remove(),b("#specvals_ed_"+c.data.speid).next(".line-dashed").remove(),b("#specvals_ed_"+c.data.speid).remove(),a.SpecificationsListskey().delsp(c.data.speid),b(".js_specifica").length<1&&b(".js_nospe_tips").removeClass("hide")):d.msg.error(c.message)},d.lang.attributeError,!1,{speid:c})})})},f.length>0&&g(new l);var m;h.length>0&&(m=new k);var n=b(".js_undertake");if(n.length>0){var o=b(".js_freight_container"),p=b(".js_freight_type"),q=b(".js_unify_container"),r=b(".js_template_container"),s=(b(".js_freight_template_loading"),b(".js_freight_template")),t=b(".js_freight_template_refresh"),u=b(".js_freight_item");n.on("click",function(){o.toggle(b(this).hasClass("js_freight_container_show"))}),p.on("click",function(){var a=b(this);q.toggle(a.hasClass("js_unify_container_show")),r.toggle(a.hasClass("js_template_container_show"))}),u.on("click",function(){var a=b(this),c=a.closest("dl");b('input[type="text"]',c).addAttr("disabled",!a.prop("checked"))}),t.on("click",function(a){a&&a.preventDefault();var c=b(this),e=c.data("remote")||c.attr("href"),f=c.find("i");f.addClass("fa-spin");var g=' <option value="{0}">{1}</option>';s.empty(),b.post(e).done(function(a){a.data&&(s.append('<option value="">请选择</option>'),b.each(a.data,function(a,b){s.append(g.format(b.id,b.name))})),f.removeClass("fa-spin"),s.focus()}).fail(function(){f.removeClass("fa-spin"),d.msg.info(d.lang.exception)})}),b(document).on("click",'button[type="submit"]',function(){if(q.is(":visible")){var a=b(".js_freight_item:checked");if(a.length<1)return d.msg.info("至少选择一个运送方式"),!1}})}b(document).on("click",".js_save_submit",function(){return b(".js_fileList li.imgbox").length<1?(d.msg.error("至少选择一个商品图片"),!1):void 0}),b(document).on("click",".js_save_submit",function(){var a=b('[data-toggle="specifications"]'),c=a.find("input[type='checkbox']:checked").length;return!a.is(":hidden")&&1>c?(d.msg.error("至少选择一个商品规格"),!1):void 0});var v=b(".js_quota");v.on("click",function(){var a=b(this).hasClass("js_quota_show"),c=b(".js_quota_container");c.toggleClass("hd",!a).toggleClass("inline",a)}),b(document).on("click",".js_submit",function(){b(this).closest("form").submit()}),b(document).on("keypress",function(a){var a=a||event,c=a.keyCode||a.which||a.charCode;return 13==c?(b(".js_spe_speval").closest(".js_enter_div").hasClass("hide")||b(".js_spe_speval").trigger("click"),b(".js_add_speval").each(function(){b(this).closest(".js_enter_div").hasClass("hide")||b(this).trigger("click")}),!1):void 0}),b(document).on("click",".js_save_submit",function(){var a=b(this),c=b(this).data("confirm"),e=a.data("confirmMsg");if(c){var f=b("#js_store_way"),g=b(".js_way_select:checked").val();if(0==g&&f.val()!=g)return d.msg.msgbox.confirm({message:e||d.lang.confirmPost,buttons:{confirm:{label:a.data("confirmText")||"确定修改"}},callback:function(b){b&&a.submit()}}),!1}}),b(document).on("click",".js_search_add_submit",function(){var a=b(this).closest("form"),c=a.attr("action"),d=b(".talbe-search").serialize();a.attr("action",c.format(d))}),b(document).on("click",".js_edit_search",function(){var a=b(this),c=a.attr("href"),d=b(".talbe-search").serialize();a.attr("href",c.format(d))})}),define("dist/goods/goods_fun",["$","dist/application/app"],function(a){"use strict";{var b=a("$");a("dist/application/app")}window.updateLabel=function(a){var c=b(".js_goods_label");c.append("<option value="+a.key+" selected>"+a.value+"</option>"),c.trigger("liszt:updated"),c.chosen()};var c=b(".js_goods_group");c.find("optgroup").each(function(){b(this).find("option").length<1&&b(this).append("<option style='display:none' value='' data-placeholder='true'>暂无数据</option>")}),c.trigger("liszt:updated"),window.updateGroup=function(a){var c=b(".js_goods_group");"0"!=a.groupId?c.find("#"+a.groupId).append("<option value="+a.key+" selected>"+a.value+"</option>"):c.append("<optgroup id="+a.key+" label="+a.value+"><option value='' data-placeholder='true'>暂无数据</option></optgroup>"),c.find("optgroup").each(function(){b(this).find("option").length>1&&b(this).find("option[data-placeholder]").length>0&&b(this).find("option[data-placeholder]").remove()}),c.trigger("liszt:updated"),b(".chzn-results .group-option").each(function(){"暂无数据"==b(this).text()&&b(this).hide()})},window.updateAddress=function(a){var c=b(".js_address_edit");c.append("<option value="+a.key+" selected>"+a.value+"</option>")}});