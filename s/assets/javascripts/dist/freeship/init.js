/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/freeship/init",["$","dist/application/app"],function(a){"use strict";function b(a){var b={};for(var c in a){if(b[a[c]])return!0;b[a[c]]=!0}return!1}var c=a("$"),d=a("dist/application/app"),e=d.config,f=d.method,g=c('[data-toggle="pricelabel"]'),h=c('[data-toggle="activitylabel"]');window.freeship_data?(template.helper("pricelabel_selected",function(a,b){return window.freeship_data.pricelabel[a]==b?'checked="checked"':e.empty}),template.helper("pricelabel_checked",function(a,b){return window.freeship_data.pricelabel[a]==b?'class="active"':e.empty}),template.helper("activitylabel_selected",function(a,b){return window.freeship_data.activitylabel[a]==b?'checked="checked"':e.empty}),template.helper("activitylabel_checked",function(a,b){return window.freeship_data.activitylabel[a]==b?'class="active"':e.empty})):(template.helper("pricelabel_selected",function(){return e.empty}),template.helper("activitylabel_selected",function(){return e.empty}));var i=function(a){f.get(window.freeship_setting.pricelabel_path,function(a){e.issucceed(a)?(g.html(template("pricelabel_template",a.data)),c(".js_pricelabel_list li").each(function(){var a=c(this),b=a.closest("ul"),d=b.attr("id"),e=b.find(".active input[type='radio']:checked").data("title");c("#label_"+d).html(e)})):e.msg.error(a.message)},e.lang.pricelabelError),a.customInput(),c(document).on("click",".js_pricelabel_list .js_custom_btn",function(){c(this).parents(".js_custom_list").prev(".js_custom_list").removeClass("hide"),c(this).parents(".js_custom_list").addClass("hide");var a=c(this).parents(".custom-select");a.scrollTop(a.get(0).scrollHeight-0+60)}),c(document).on("click",".js_pricelabel_list .js_custom_list_save",function(){var b=c(this).parents(".js_custom_list").find(".js_custom_input"),d=c(this).data("name"),f=a.customdata(b);a.customValvali(b)&&b.val()&&(a.getValExist(b.val(),f.id)?e.msg.info("已经存在的属性值"):a.addVal(f,d,b,!1,c(this),window.freeship_setting.custom_pricevalue_path)),b.val()||e.msg.error("属性值为空！")}),c(document).on("click",".js_pricelabel_list .js_custom_list_cancel",function(){c(this).parents(".js_custom_list").next(".js_custom_list").removeClass("hide"),c(this).parents(".js_custom_list").addClass("hide")}),c(document).on("click",".js_pricelabel_list .js_custom_del",function(){var b=c(this).prev("a").find("input[type='radio']"),d=b.val();f.post(window.freeship_setting.custom_pricevalue_del_path,function(f){e.issucceed(f)?(b.prop("checked")?c("#label_"+b.data("id")).html("选择"):a.getValExist(c("#label_"+b.data("id")).text(),b.data("id"))||c("#label_"+d).html("选择"),b.parents("li").remove(),e.msg.info(f.message||e.lang.removeSuccess)):e.msg.error(f.message)},e.lang.pricelabelError,!1,{id:b.data("id"),valid:d})})},j=function(a){f.get(window.freeship_setting.activitylabel_path,function(a){e.issucceed(a)?(h.html(template("activitylabel_template",a.data)),c(".js_activitylabel_list li").each(function(){var a=c(this),b=a.closest("ul"),d=b.attr("id"),e=b.find(".active input[type='radio']:checked").data("title");c("#label_"+d).html(e)})):e.msg.error(a.message)},e.lang.activitylabelError),a.customInput(),c(document).on("click",".js_activitylabel_list .js_custom_btn",function(){c(this).parents(".js_custom_list").prev(".js_custom_list").removeClass("hide"),c(this).parents(".js_custom_list").addClass("hide");var a=c(this).parents(".custom-select");a.scrollTop(a.get(0).scrollHeight-0+60)}),c(document).on("click",".js_activitylabel_list .js_custom_list_save",function(){var b=c(this).parents(".js_custom_list").find(".js_custom_input"),d=c(this).data("name"),f=a.customdata(b);a.customValvali(b)&&b.val()&&(a.getValExist(b.val(),f.id)?e.msg.info("已经存在的属性值"):a.addVal(f,d,b,!1,c(this),window.freeship_setting.custom_activityvalue_path)),b.val()||e.msg.error("属性值为空！")}),c(document).on("click",".js_activitylabel_list .js_custom_list_cancel",function(){c(this).parents(".js_custom_list").next(".js_custom_list").removeClass("hide"),c(this).parents(".js_custom_list").addClass("hide")}),c(document).on("click",".js_activitylabel_list .js_custom_del",function(){var b=c(this).prev("a").find("input[type='radio']"),d=b.val();f.post(window.freeship_setting.custom_activityvalue_del_path,function(f){e.issucceed(f)?(b.prop("checked")?c("#label_"+b.data("id")).html("选择"):a.getValExist(c("#label_"+b.data("id")).text(),b.data("id"))||c("#label_"+d).html("选择"),b.parents("li").remove(),e.msg.info(f.message||e.lang.removeSuccess)):e.msg.error(f.message)},e.lang.activitylabelError,!1,{id:b.data("id"),valid:d})})},k=function(){};k.prototype.customInput=function(){var a=this;c(document).on("keyup",".js_custom_input",function(){var b=a.getInputLen(c(this)),d=c(this).data("limit"),e=d[0]-0,f=d[1]-0,g=c(this).next(".js_limit");g.find("em").html(Math.ceil(b/2)),b>2*f||2*e>b?g.addClass("error"):g.removeClass("error")})},k.prototype.getInputLen=function(a){return a.val().replace(/[^\x00-\xff]/g,"xx").length},k.prototype.customdata=function(a){return{id:a.data("id"),val:a.val()}},k.prototype.customValvali=function(a){var b=!0,c=a.data("limit"),d=c[0]-0,e=c[1]-0,f=this.getInputLen(a);return b=2*e>=f&&f>=2*d?!0:!1},k.prototype.getValExist=function(a,b){var d,e,f=[];return c("#"+b).find("input[type='radio']").each(function(){c(this).val()&&f.push(c(this).data("title"))}),e=c.inArray(a,f),d=0>e?!1:!0},k.prototype.addVal=function(a,b,d,f,g,h){var i=this;g.data("loadingText",'<i class="fa fa-spinner fa-spin"></i>提交中'),g.button("loading"),c.ajax(h,{type:"post",data:a,dataType:"json"}).done(function(a){if(g.button("reset"),e.issucceed(a)){{a.data}a.data.checked=!0,a.data.name=b,i.result(a.data,d,f)}else e.msg.error(a.message)}).fail(function(){g.button("reset"),e.msg.info(e.lang.exception)})},k.prototype.result=function(a,b){var d=c("#"+a.id).find(".js_custom_list:first");c("#"+a.id).find("li").removeClass("active"),c("#"+a.id).find("li input[type='radio']").removeAttr("checked"),c(template("customval_tem",a)).insertBefore(d),c("#label_"+a.id).html(a.title),c("#label_"+a.id).removeClass("error"),c(document).trigger("click"),b.val(""),b.next(".js_limit").find("em").html(0),d.addClass("hide"),d.next(".js_custom_list").removeClass("hide"),c("#"+a.id).find(".js_search_result").addClass("hide"),e.msg.info(e.lang.saveSuccess)},g.length>0&&i(new k),h.length>0&&j(new k),c(".js_add_privilege").length&&function(){5==c(".js_privilege_list").length&&(c(".js_add_privilege").addClass("hide"),c(".js_add_privilege").closest(".form-group").next(".line-dashed").addClass("hide"))}(),c(document).on("click",".js_add_privilege",function(){var a=c(this),b=a.closest(".form-group"),d=c(".js_privilege_list:last").data("num")-0+1,e=c(".js_discount_check:first").prop("checked"),f=c(".js_minus_check:first").prop("checked"),g="",h=c(".js_content1:checked").length,i=c(".js_content2:checked").length,j="";e&&(g="js_discount_check"),f&&(g="js_minus_check"),h&&(j="js_content1"),i&&(j="js_content2"),4==c(".js_privilege_list").length&&(a.addClass("hide"),b.next(".line-dashed").addClass("hide")),c(template("privilege_template",{num:d+1,index:d,select:g,content:j})).insertBefore(b),c('[data-toggle="popover"]').popover()}),c(document).on("click",".js_discount_check:first",function(){var a=c(this),b=a.prop("checked"),d=c(".js_minus_input"),e=c(".js_discount_input");b&&(d.prop("disabled",!0),d.prop("readonly",!1),c(".js_discount_check").prop("checked",!0),c(".js_minus_check").prop("disabled",!0),c(".js_minus_check:first").prop("disabled",!1),c(".js_minus_check").each(function(){var a=c(this),b=a.closest(".form-group");b.find("input[type='text']").removeClass("error"),b.find("span.error").remove()}),e.prop("disabled",!1),e.prop("readonly",!1))}),c(".js_minus_check").length>0&&function(){var a=c(".js_minus_check:checked"),b=c(".js_discount_check:checked"),d=c(".js_content1:checked"),e=c(".js_content2:checked");a.length?(c(".js_minus_input").prop("disabled",!1),c(".js_discount_check").prop("disabled",!0),c(".js_discount_check:first").prop("disabled",!1)):(c(".js_minus_input").prop("disabled",!0),c(".js_discount_check").prop("disabled",!1)),b.length?(c(".js_discount_input").prop("disabled",!1),c(".js_minus_check").prop("disabled",!0),c(".js_minus_check:first").prop("disabled",!1)):c(".js_discount_input").prop("disabled",!0),d.length?(c(".js_content2").prop("disabled",!0),c(".js_content2:first").prop("disabled",!1),c(".js_cap").prop("disabled",!0)):c(".js_content_input1").prop("disabled",!0),e.length?(c(".js_content1").prop("disabled",!0),c(".js_content1:first").prop("disabled",!1)):c(".js_content_input2").prop("disabled",!0)}(),c(document).on("click",".js_minus_check:first",function(){var a=c(this),b=a.prop("checked"),d=c(".js_minus_input"),e=c(".js_discount_input");b&&(d.prop("disabled",!1),d.prop("readonly",!1),c(".js_minus_check").prop("checked",!0),c(".js_discount_check").each(function(){var a=c(this),b=a.closest(".form-group");b.find("input[type='text']").removeClass("error"),b.find("span.error").remove()}),c(".js_discount_check").prop("disabled",!0),c(".js_discount_check:first").prop("disabled",!1),e.prop("disabled",!0),e.prop("readonly",!0))}),c(document).on("click",".js_content1",function(){var a=c(this),b=a.prop("checked"),d=c(".js_content_input2"),e=(c(".js_content_input1"),c(".js_content1:checked").length),f=a.closest(".form-group").find(".js_content_input1");if(b)d.prop("readonly",!0),d.prop("disabled",!0),c(".js_content1").prop("disabled",!1),c(".js_content2").prop("checked",!1),c(".js_content2").prop("disabled",!0),c(".js_content2:first").prop("disabled",!1),c(".js_content2").each(function(){var a=c(this),b=a.closest(".form-group");b.find("input[type='text']").removeClass("error"),b.find("span.error").remove()}),c(".js_cap").prop("disabled",!0),c(".js_cap").prop("checked",!1),f.prop("readonly",!1),f.prop("disabled",!1);else{f.prop("readonly",!0),f.prop("disabled",!0);var g=c(".js_content1"),h=g.closest(".form-group");h.find("input[type='text']").removeClass("error"),h.find("span.error").remove(),e||c(".js_content2").prop("disabled",!1)}}),c(document).on("click",".js_content2",function(){var a=c(this),b=a.prop("checked"),d=(c(".js_content_input2"),c(".js_content_input1")),e=c(".js_content1:checked").length,f=a.closest(".form-group").find(".js_content_input2");if(b)d.prop("readonly",!0),d.prop("disabled",!0),c(".js_content2").prop("disabled",!1),c(".js_content1").prop("checked",!1),c(".js_content1").prop("disabled",!0),c(".js_content1:first").prop("disabled",!1),c(".js_content1").each(function(){var a=c(this),b=a.closest(".form-group");b.find("input[type='text']").removeClass("error"),b.find("span.error").remove()}),c(".js_cap",a.closest(".form-group")).prop("disabled",!1),f.prop("readonly",!1),f.prop("disabled",!1);else{f.prop("readonly",!0),f.prop("disabled",!0),c(".js_cap",a.closest(".form-group")).prop("disabled",!0);var g=c(".js_content2"),h=g.closest(".form-group");h.find("input[type='text']").removeClass("error"),h.find("span.error").remove(),e||c(".js_content1").prop("disabled",!1)}}),c(document).on("click",".js_del_privilege",function(){var a=c(this),b=a.closest(".js_privilege_list");b.remove(),c(".js_add_privilege").removeClass("hide"),c(".js_del_privilege:last").removeClass("hide")}),c(".js_minus_input").length>0&&c(document).on("click","button[type='submit']",function(){var a=!0,d=[],f=c(".js_minus_input:first").prop("disabled");return f?c(".js_discount_input").each(function(){var a=c(this).val();a&&a.length>0&&d.push(a)}):c(".js_minus_input").each(function(){var a=c(this).val();a&&a.length>0&&d.push(a)}),a=!b(d),a||e.msg.error("存在相同的活动条件，请修改"),a}),c(".js_minus_input").length>0&&c(document).on("click","button[type='submit']",function(){{var a=!0;c(".js_minus_input:first").prop("disabled")}return c(".js_privilege_list").each(function(){var b=c(this),d=c(".js_content1",b),e=c(".js_content2",b),f=c(".js_free",b);d.prop("checked")||e.prop("checked")||f.prop("checked")||(a=!1)})}),h.length>0&&c(document).on("click","button[type='submit']",function(){var a=h.find(".js_activitylabel_list input[type='radio']:checked");return void 0==a.val()||""==a.val()?(e.msg.error("请选择活动标签"),!1):void 0})});