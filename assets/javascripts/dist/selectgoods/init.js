/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/selectgoods/init",["$","dist/application/app","./monkey","./jq_pagination","./template/item.html","./template/item2.html"],function(a,b){"use strict";{var c=a("$"),d=a("dist/application/app"),e=a("./monkey"),f=d.config;d.method}a("./jq_pagination");var g=a("./template/item.html"),h=a("./template/item2.html");template.helper("isselect",function(a,b){return c.inArray(a,b.split(",")||[])<0?"":"active"}),b.init=function(a){var b=function(a){this.opts=c.extend(!0,{modal:null,type:null,select:null,goodsurl:"/Plus/selectgoods.php"},a||{}),this.init()};b.prototype={init:function(){var a=this;a.create({page:1}),a._click(),a.searchF()},create:function(a){var b=this;e.post(b.opts.goodsurl,function(a){if(f.issucceed(a)){b.opts.type==window.goods_set.type&&(a.data.selectid=b.opts.select.val()),c("#all-list-box").html(template.compile(g)(a.data));var d=function(){c("#Pagination").pagination(a.data.chief,{num_edge_entries:1,num_display_entries:4,callback:i,items_per_page:1,prev_text:"&laquo",next_text:"&raquo",load_first_page:!0})},i=function(a){var d=c("form.search-form",b.opts.modal).serialize();return d+="&page="+(a+1),c("#all-list-box div.list-box:eq("+a+")").data("crate")||e.postd(b.opts.goodsurl,function(a){if(f.issucceed(a)){b.opts.type==window.goods_set.type&&(a.data.selectid=b.opts.select.val());var d=template.compile(h)(a.data);c("#all-list-box").html(d)}else f.msg.error(a.message)},d),!1};d()}else f.msg.error(a.message)},"",null,a)},_click:function(){},searchF:function(){var a=this;c(document).on("click","#goodssearch",function(){var b=c("form.search-form",a.opts.modal).serialize();b+="&page=1",a.create(b)})}};var d=c("[data-toggle='selectGoodss']",a);d.length>0&&d.each(function(){var a=c(this),d=[],d=c.extend(!0,[],window.goods_set.selectid),e=c(c(a.data("tmodal")).length>0?a.data("tmodal"):"#js_goodes_modal");a.on("click",function(){d=c.extend(!0,[],window.goods_set.selectid);var a=c(this),e=c(c(a.data("tmodal")).length>0?a.data("tmodal"):"#js_goodes_modal"),f=a.data("type"),g=c(c(a.data("selectid")).length>0?a.data("selectid"):"#js_selected_id"),h=a.data("target"),i=a.data("path"),j=c("#js_tr_id"),k=a.data("id");e.attr("data-type",f),e.attr("data-target",h),e.attr("data-select",a.data("selectid")||"#js_selected_id"),e.attr("data-logo",a.data("logo"));var l=c("#js_selected_id",e);j.length>0&&j.val(k),l.val(c(".js_goods_id",h).val()||a.data("goodsid")),""==l.val()&&l.val(window.goods_set.selectid),e.modal("show"),i&&new b({modal:e,type:f,button:a,select:g,goodsurl:i})}),e.on("click","li.itmes-mul",function(){var a=c(this).data("cid")+"",b=c(this).find("a");b.toggleClass("active"),c(this).toggleClass("active"),c(this).hasClass("active")?-1==c.inArray(a,d)&&d.push(a):d.splice(c.inArray(a,d),1);var f=c(e.attr("data-select"));f.val(d)}),e.on("click","button.js_save_btn",function(){e.modal("hide");{var a=c(e.attr("data-select")),b=e.attr("data-target");c(e.attr("data-logo")),e.attr("data-type")}a.val(d),c(b).find("input[type='hidden']").val(d),window.goods_set.selectid=d});var f=a.prev("input[type='text']");f.length>0&&f.on("click",function(){a.trigger("click")})})}}),define("dist/selectgoods/monkey",["$"],function(a){"use strict";var b=a("$"),c=function(a,c,d,e,f){var g='<img src="/assets/images/loading.gif"/>',h="",i=[],j=(new Date).getTime()+parseInt(1e5*Math.random());if(j&&(h="background:rgba(255, 255, 255, 0.6); filter:alpha(opacity=30); _background:#fff;"),d.length){var k='<div style="'+h+'" id="loadingBox_'+j+'" class="monkey-ajax-loading">'+g+"</div>";b("body").append(k),i[j]=b("#loadingBox_"+j);var l=b(d),m=l.outerWidth(),n=l.outerHeight(),o=l.offset().top,p=l.offset().left,q=b("#loadingBox_"+j),r=32;q.css({position:"absolute","z-index":"10000","text-align":"center",width:m+"px",height:n-(n/2-r/2)+"px",paddingTop:n/2-r/2+"px",top:o+"px",left:p+"px"})}b.ajax(a,{type:e||"post",data:f,dataType:"json"}).done(function(a){b(d).length&&i[j]&&i[j].remove(),c&&c(a)}).fail(function(){b(d).length&&i[j]&&i[j].remove()})};return{get:function(a,b,d){c(a,b,d,"get")},post:function(a,b,d,e,f){c(a,b,d,e,f)},postd:function(a,b,d){c(a,b,!1,!1,d)},placeholder:function(a){b(a).placeholder()}}}),define("dist/selectgoods/jq_pagination",[],function(){jQuery.fn.pagination=function(a,b){return b=jQuery.extend({items_per_page:10,num_display_entries:10,current_page:0,num_edge_entries:0,link_to:"#",prev_text:"Prev",next_text:"Next",ellipse_text:"...",prev_show_always:!0,next_show_always:!0,callback:function(){return!1}},b||{}),this.each(function(){function c(){return Math.ceil(a/b.items_per_page)}function d(){var a=Math.ceil(b.num_display_entries/2),d=c(),e=d-b.num_display_entries,f=g>a?Math.max(Math.min(g-a,e),0):0,h=g>a?Math.min(g+a,d):Math.min(b.num_display_entries,d);return[f,h]}function e(a,c){g=a,f();var d=b.callback(a,h);return d||(c.stopPropagation?c.stopPropagation():c.cancelBubble=!0),d}function f(){h.empty();var a=d(),f=c(),i=function(a){return function(b){return e(a,b)}},j=function(a,c){if(a=0>a?0:f>a?a:f-1,c=jQuery.extend({text:a+1,classes:""},c||{}),a==g)var d=jQuery("<span class='current'>"+c.text+"</span>");else var d=jQuery("<a>"+c.text+"</a>").bind("click",i(a)).attr("href",b.link_to.replace(/__id__/,a));c.classes&&d.addClass(c.classes),h.append(d)};if(b.prev_text&&(g>0||b.prev_show_always)&&j(g-1,{text:b.prev_text,classes:"prev"}),a[0]>0&&b.num_edge_entries>0){for(var k=Math.min(b.num_edge_entries,a[0]),l=0;k>l;l++)j(l);b.num_edge_entries<a[0]&&b.ellipse_text&&jQuery("<span>"+b.ellipse_text+"</span>").appendTo(h)}for(var l=a[0];l<a[1];l++)j(l);if(a[1]<f&&b.num_edge_entries>0){f-b.num_edge_entries>a[1]&&b.ellipse_text&&jQuery("<span>"+b.ellipse_text+"</span>").appendTo(h);for(var m=Math.max(f-b.num_edge_entries,a[1]),l=m;f>l;l++)j(l)}b.next_text&&(f-1>g||b.next_show_always)&&j(g+1,{text:b.next_text,classes:"next"})}var g=b.current_page;a=!a||0>a?1:a,b.items_per_page=!b.items_per_page||b.items_per_page<0?1:b.items_per_page;var h=jQuery(this);this.selectPage=function(a){e(a)},this.prevPage=function(){return g>0?(e(g-1),!0):!1},this.nextPage=function(){return g<c()-1?(e(g+1),!0):!1},f(),b.callback(g,this)})}}),define("dist/selectgoods/template/item.html",[],'<div class="list-box" data-crate="true">\n  <ul>\n      {{each data as value k}}\n          <li class="itmes itmes-mul {{isselect value.cid selectid}} goods_items_{{value.cid}}" id="" data-cid="{{value.cid}}" data-url="{{value.url}}" data-imgsrc="{{value.imgsrc}}" data-logo="{{value.logo}}" data-text="{{value.text}}">\n              <div class="col-sm-7">\n                  <img class="thumb_img js_view_img" src="{{value.imgsrc}}" style="height: 60px;width:60px;">{{value.text}}\n              </div>\n              <div  class="col-sm-3"><span class="pirce money">{{value.price}}</span></div>\n              <div  class="col-sm-2">\n                  <a href="#" title="选择" class="{{isselect value.cid selectid}}"><i class="fa fa-check text-success text-active"></i><i class="fa fa-times text-danger text"></i></a>\n              </div>\n          </li>\n      {{/each}}\n  </ul>\n</div>\n\n\n '),define("dist/selectgoods/template/item2.html",[],'<div class="list-box">\n	<ul>\n		{{each data as value}}\n		<li class="itmes itmes-mul {{isselect value.cid selectid}} goods_items_{{value.cid}}" id="" data-cid="{{value.cid}}" data-url="{{value.url}}" data-imgsrc="{{value.imgsrc}}" data-logo="{{value.logo}}" data-text="{{value.text}}">\n			<div class="col-sm-7">\n				<img class="thumb_img js_view_img" src="{{value.imgsrc}}" style="height: 60px;width:60px;">{{value.text}}</div>\n			<div  class="col-sm-3">\n				<span class="pirce money">{{value.price}}</span>\n			</div>\n			<div  class="col-sm-2">\n				<a href="#" title="选择" class="{{isselect value.cid selectid}}"> <i class="fa fa-check text-success text-active"></i> <i class="fa fa-times text-danger text"></i>\n				</a>\n			</div>\n		</li>\n		{{/each}}\n	</ul>\n</div>');